<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <title>Dämliche Ideen für Zuhause</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; margin: 0; padding: 0; }
    header { background: #00a9ce; color: white; padding: 1rem; text-align: center; }
    .board {
      display: flex; justify-content: space-around; flex-wrap: wrap; padding: 1rem;
    }
    .column {
      background: #f0f0f0; flex: 1; min-width: 250px; margin: 0.5rem;
      padding: 1rem; border-radius: 6px;
    }
    .ticket {
      background: white; padding: 0.8rem; border-left: 5px solid #00a9ce;
      margin-bottom: 1rem; border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05); position: relative;
    }
    form {
      max-width: 600px; margin: 2rem auto;
      background: white; padding: 1rem;
      border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: flex; flex-direction: column;
    }
    input, textarea, select {
      margin-bottom: 1rem; padding: 0.5rem; font-size: 1rem;
    }
    button {
      padding: 0.5rem; background: #00a9ce; color: white;
      border: none; border-radius: 4px; cursor: pointer;
    }
    .delete-btn {
      position: absolute; top: 10px; right: 10px;
      background: #e74c3c; color: white;
      border: none; border-radius: 50%;
      width: 22px; height: 22px; font-size: 14px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    }
    #abgelehntCol {
      background-color: #ffe6e6 !important;
    }
    .edit-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    @media (max-width: 768px) {
      .board {
        flex-direction: column;
        align-items: center;
      }
      .column {
        width: 90% !important;
      }
    }
    .expired {
      background-color: #fff4f4 !important;
      border-left: 5px solid #e53935 !important;
    }
    .ticket-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 6px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <header><h1>Dämliche Ideen für Zuhause</h1></header>

  <form id="ticketForm">
    <input id="name" placeholder="Dein Name" required type="text"/>
    <input id="subject" placeholder="Betreff" required type="text"/>
    <textarea id="message" placeholder="Nachricht" required rows="4"></textarea>
    <input id="enddate" placeholder="Enddatum" type="date"/>
    <button type="submit">Ticket speichern</button>
  </form>

  <div class="board">
    <div class="column" id="neuCol"><h3 style="text-align:center;">Neu</h3></div>
    <div class="column" id="bearbeitungCol"><h3 style="text-align:center;">In Bearbeitung</h3></div>
    <div class="column" id="abgeschlossenCol"><h3 style="text-align:center;">Abgeschlossen</h3></div>
    <div class="column" id="abgelehntCol"><h3 style="text-align:center;">Abgelehnt</h3></div>
  </div>

  <script>
    let tickets = JSON.parse(localStorage.getItem("tickets")) || [];

    function saveTickets() {
      localStorage.setItem("tickets", JSON.stringify(tickets));
    }

    function deleteTicket(index) {
      tickets.splice(index, 1);
      saveTickets();
      loadTickets();
    }

    function loadTickets() {
      const columns = {
        neu: document.getElementById("neuCol"),
        bearbeitung: document.getElementById("bearbeitungCol"),
        abgeschlossen: document.getElementById("abgeschlossenCol"),
        abgelehnt: document.getElementById("abgelehntCol")
      };

      Object.values(columns).forEach(col => {
        col.querySelectorAll(".ticket").forEach(el => el.remove());
      });

      tickets.forEach((ticket, index) => {
        const div = document.createElement("div");
        div.className = "ticket";
        if (ticket.enddate) {
          const now = new Date();
          const end = new Date(ticket.enddate);
          if (end < now) {
            div.classList.add("expired");
          }
        }
        div.setAttribute("draggable", "true");
        div.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", index);
        });
        if (ticket.status === "bearbeitung") div.style.borderLeftColor = "#ff9800";
        if (ticket.status === "abgeschlossen") div.style.borderLeftColor = "#9c27b0";
        if (ticket.status === "abgelehnt") div.style.borderLeftColor = "#e74c3c";

        div.innerHTML = `
          <div style="font-size:0.8rem; color:#666;">Allgemein</div>
          <strong>${ticket.subject}</strong><br>
          <small>${ticket.name}${ticket.enddate ? " – Ende: " + ticket.enddate : ""}</small>
          <p>${ticket.message}</p>
          ${ticket.status === "neu" ? `<div style="margin-top:10px;"><button onclick="acceptTicket(${index})" style="margin-right:5px;">Akzeptieren</button><button onclick="rejectTicket(${index})">Ablehnen</button></div>` : ``}
          <div class="ticket-header">
            <span></span>
            <div>
              <button class="edit-btn" onclick="editTicket(${index})">✎</button>
              <button class="delete-btn" onclick="deleteTicket(${index})">✕</button>
            </div>
          </div>
        `;
        columns[ticket.status].appendChild(div);
      });
    }

    document.getElementById("ticketForm").addEventListener("submit", e => {
      e.preventDefault();
      const ticket = {
        name: document.getElementById("name").value,
        subject: document.getElementById("subject").value,
        message: document.getElementById("message").value,
        status: "neu",
        enddate: document.getElementById("enddate").value,
        date: new Date().toLocaleString()
      };
      tickets.push(ticket);
      saveTickets();
      loadTickets();
      e.target.reset();
    });

    ["neuCol", "bearbeitungCol", "abgeschlossenCol", "abgelehntCol"].forEach(id => {
      const col = document.getElementById(id);
      col.addEventListener("dragover", e => e.preventDefault());
      col.addEventListener("drop", e => {
        e.preventDefault();
        const index = e.dataTransfer.getData("text/plain");
        const newStatus = id.replace("Col", "");
        if (tickets[index]) {
          tickets[index].status = newStatus;
          saveTickets();
          loadTickets();
        }
      });
    });

    function acceptTicket(index) {
      tickets[index].status = "bearbeitung";
      saveTickets();
      loadTickets();
    }

    function rejectTicket(index) {
      const reason = prompt("Bitte gib eine Begründung für die Ablehnung ein:");
      if (reason) {
        tickets[index].status = "abgelehnt";
        tickets[index].message += "\n\n[Abgelehnt: " + reason + "]";
        saveTickets();
        loadTickets();
      }
    }

    function editTicket(index) {
      const ticket = tickets[index];
      const newSubject = prompt("Neuer Betreff:", ticket.subject);
      if (newSubject !== null) ticket.subject = newSubject;

      const newMessage = prompt("Neue Nachricht:", ticket.message);
      if (newMessage !== null) ticket.message = newMessage;

      const newEnd = prompt("Neues Enddatum (YYYY-MM-DD):", ticket.enddate);
      if (newEnd !== null) ticket.enddate = newEnd;

      const newName = prompt("Neuer Name:", ticket.name);
      if (newName !== null) ticket.name = newName;

      saveTickets();
      loadTickets();
    }

    loadTickets();
  </script>
</body>
</html>
